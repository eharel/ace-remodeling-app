# Firebase Storage Integration Guide

## Overview

The seed script now automatically uses real Firebase Storage photos when available, falling back to mock data if not.

## How It Works

### 1. Upload Photos First

```bash
# Upload project photos to Firebase Storage
npm run upload

# This creates: scripts/output/kitchen-projects.json
```

### 2. Seed Database

```bash
# Seed Firestore with real photos
npm run seed
```

The seed script will:

- ✅ Check for `scripts/output/kitchen-projects.json`
- ✅ If found: Use real Firebase Storage photos
- ✅ If not found: Use mock Unsplash photos from `seedData.ts`

## File Structure

```
scripts/
├── uploadPhotos.ts          # Upload photos to Firebase Storage
├── seedFirebase.ts          # Seed Firestore (auto-detects uploaded photos)
└── output/
    └── kitchen-projects.json  # Generated by upload script
```

## Data Flow

```
Local Photos
    ↓
[Upload Script]
    ↓
Firebase Storage + kitchen-projects.json
    ↓
[Seed Script]
    ↓
Firestore Database
    ↓
React Native App
```

## Console Output

### With Uploaded Photos

```
🌱 Starting Firebase Database Seeding
=====================================

⏰ Started at: 10/14/2025, 8:30:00 PM
✅ Loaded 11 uploaded projects from Firebase Storage
📊 Projects to seed: 11 (uploaded from Firebase Storage)

🗑️  Clearing existing projects...
✅ Deleted 0 existing project(s)

📦 Adding 11 projects from Firebase Storage...
   (11 uploaded projects with real photos)

   🎨 Added: "Luxe Revival" (kitchen, 15 photos) - ID: abc123
   🎨 Added: "Quiet Elegance" (kitchen, 22 photos) - ID: def456
   ...
```

### Without Uploaded Photos

```
🌱 Starting Firebase Database Seeding
=====================================

⏰ Started at: 10/14/2025, 8:30:00 PM
ℹ️  No uploaded projects file found, using seed data only
📊 Projects to seed: 4 (mock seed data)

🗑️  Clearing existing projects...
✅ Deleted 0 existing project(s)

📦 Adding 4 seed projects...
   (Using mock data - no uploaded projects found)

   📷 Added: "Luxury Master Bathroom Remodel" (bathroom, 6 photos) - ID: xyz789
   ...
```

## Icon Legend

- 🎨 = Real photos from Firebase Storage
- 📷 = Mock photos from Unsplash

## What Gets Converted

When using uploaded photos, the seed script automatically converts:

| Upload JSON                | Firestore Project        |
| -------------------------- | ------------------------ |
| `id: "104"`                | `projectNumber: "104"`   |
| `slug: "104-luxe-revival"` | Used as base for IDs     |
| `name: "Luxe Revival"`     | `name: "Luxe Revival"`   |
| `category: "kitchen"`      | `category: "kitchen"`    |
| `photos[]`                 | `pictures[]` (converted) |
| Photo `url`                | Picture `url`            |
| Photo `category`           | Picture `type` (mapped)  |
| Photo `storagePath`        | Picture `storagePath`    |

### Category Mapping

Upload categories → Picture types:

- `before` → `before`
- `after` → `after`
- `progress` → `progress`
- `rendering` → `rendering`
- `materials` → `detail`
- `other` → `other`

## Updating Types

The `Picture` interface was extended to support Firebase Storage data:

```typescript
interface Picture {
  id: string;
  url: string;
  type: "before" | "after" | "progress" | "detail" | "rendering" | "other";

  // New fields for Firebase Storage integration:
  category?: string; // Original upload category
  filename?: string; // Original filename
  storagePath?: string; // Firebase Storage path
  size?: number; // File size in bytes

  // Other fields...
}
```

## Workflow Examples

### Adding New Kitchen Projects

```bash
# 1. Add photos to local folder
# /Users/you/ace-remodeling-assets/kitchen/148 - New Project - Kitchen/

# 2. Upload to Firebase Storage
npm run upload

# 3. Seed Firestore (auto-uses new photos)
npm run seed

# 4. Verify in app
npm start
```

### Switching Categories

```bash
# Upload bathroom projects
# (Update LOCAL_PHOTOS_PATH in uploadConfig.ts to bathroom folder)
npm run upload

# Seed database (will use bathroom photos)
npm run seed
```

### Development Without Photos

If you don't have photos uploaded yet:

```bash
# Just run seed - it uses mock data
npm run seed

# App still works with Unsplash placeholders
```

## Troubleshooting

### "Using mock data" when I uploaded photos

**Check:**

1. Did upload complete successfully?
2. Is `scripts/output/kitchen-projects.json` present?
3. Run `npm run upload` again if needed

### Photos not showing in app

**Check:**

1. Firebase Storage URLs are publicly readable
2. Storage rules allow read access
3. URLs in Firestore are correct (check Firebase Console)

### Wrong photos for projects

**Issue:** Upload script might have categorized files incorrectly

**Fix:**

1. Review folder naming in local assets
2. Check category mappings in `uploadConfig.ts`
3. Re-upload with correct folder structure

## Advanced: Custom Integration

To customize which projects use real vs mock photos:

```typescript
// In seedFirebase.ts, modify addSeedProjects():

// Mix real and mock data
const projectsToSeed = [
  ...uploadedProjects.slice(0, 5).map(convertUploadedProject), // First 5 real
  ...seedProjects.slice(5), // Rest mock
];
```

## Benefits

✅ **Automatic**: No manual URL copying  
✅ **Type-safe**: Full TypeScript validation  
✅ **Flexible**: Works with or without uploaded photos  
✅ **Clear feedback**: Know which projects have real photos  
✅ **Maintainable**: Single source of truth

## Next Steps

1. Upload all project categories (kitchen, bathroom, outdoor)
2. Update category in `uploadConfig.ts` for each
3. Run seed script to update Firestore
4. Verify all projects display correctly in app
